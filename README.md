# Сервис для асинхронного создания изображений

Сервис для асинхронного создания изображений с использованием API Fusion Brain.
Поддерживает:

-   Очередь задач через Redis
-   Хранение оригиналов и миниатюр в MinIO
-   REST API для создания и получения изображений
-   Создание миниатюр (128x128)
-   Документацию через Swagger

---

## Технологии

-   Node.js 22 + NestJS
-   TypeScript
-   Redis (для очереди задач)
-   MinIO (для хранения изображений)
-   Prisma ORM + PostgreSQL
-   Jimp (генерация миниатюр)
-   Docker + Docker Compose

---

## Флоу обработки изображения

1. **Клиент создаёт задачу**POST-запрос на контроллер с параметрами `prompt` и `style`.Контроллер:

    - валидирует данные,
    - создаёт запись в БД (`status = created`),
    - кладёт задачу в Redis.

2. **Воркер берёт задачу**

    - Вызывает API генерации изображения.
    - Сохраняет `uuid` запроса и меняет статус на `pending`.
    - Задача возвращается в очередь для последующего опроса.

3. **Проверка готовности**

    - Воркер опрашивает API по `uuid`.
    - Если изображение готово:
        - загружает оригинал в MinIO,
        - создаёт миниатюру 128×128 через Jimp,
        - сохраняет миниатюру в MinIO,
        - обновляет запись в БД (`status = done` и сохраняет внутренние id файлов MinIO).
    - Если не готово — задача остаётся в очереди для следующего цикла.

4. **Получение пользователем**
   GET-запрос на контроллер с `id` изображения и параметром `type=original|thumbnail`.
   Контроллер возвращает временную ссылку на файл в MinIO..

---

## Установка и запуск

```bash
# Клонируем репозиторий
git clone <URL>
cd <repo>

# Копируем и редактируем .env
cp .env.example .env

# Сборка и запуск через Docker Compose
docker-compose build --no-cache
docker-compose up
```

## Примечания

• Проект выполнен в качестве тестового задания, не для продакшена
• Внешний Fusion Brain API может временно возвращать ошибки (500)

## Планы на будущее

• Реализовать адекватные эндпоинты для валидации запросов/ответов Fusion Brain API
• Типизировать .env
• Оптимизировать сборку Docker-контейнеров
• Завести адекватную типизацию для тасок в Redis
